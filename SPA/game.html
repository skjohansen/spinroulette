<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Spin Roulette</title>
</head>

<body>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.4.min.js"></script>

	
Play roulette
<div id="Welcome">
<button id="showNewGame">Create new game</button>

Pick a game to join (list games)
<table id="gamelist" style="display:none;">
    <tr>
        <th>Game Id</th>
        <th>Cylinder Size</th>
		<th>Trigger pulls</th>
    </tr>
	<tr><td><a href="">GAMEID</a></td><td>Cyl Size</td><td>Shooots</td></tr>
</table>
</div>
<div id="Game"  style="display:none;">
<button onclick="pullTrigger()">Pull the trigger</button>
<button onclick="reloadGun()">Reload gun</button>
</div>
<div id="newGamePopup" style="display:none;">
Size of cylinder
<input type="number" id="cylinderSize" size="4">
<button id="createNewGame">Create</button>
</div>

<script>
var currentGameId = '';
$(function() {
	showGames();
	populateGameList();
});

function pullTrigger(){
  $.ajax({
	type: "POST",
    url: "http://localhost:50712/v1/games/"+currentGameId,
	crossDomain: true,
    contentType: "application/json; charset=utf-8",
    dataType: "json",
	statusCode: {
		410: function(data) {
			showGames();
			populateGameList();
			
			
		}
	},
    success: function(data)
	{
		showGames();
		populateGameList();
	},
    failure: function(errMsg) {
        alert(errMsg);
    }
  });
}

function reloadGun(){
  $.ajax({
	type: "PATCH",
    url: "http://localhost:50712/v1/games/"+currentGameId,
	crossDomain: true,
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    success: function(data)
	{
		showGames();
		populateGameList();
	},
    failure: function(errMsg) {
        alert(errMsg);
    }
  });
}

function showGames(){
	currentGameId = "";
		$('#Welcome').show();
	$('#Game').hide();
}

function showGame(gameId){
	currentGameId = gameId;
	$('#Welcome').hide();
	$('#Game').show();
}

function populateGameList(){
	$('#gamelist tr').not(':first').remove();
	$('#gamelist').hide();
$.ajax({
  url: "http://localhost:50712/v1/games",
  context: document.body
}).done(function(gamesData) {
	var html = '';
	for(var i = 0; i < gamesData.length; i++){
				html += '<tr><td><a href="#" onclick="showGame(\''+gamesData[i].GameId +'\')">' + gamesData[i].GameId + 
						'</a></td><td>' + gamesData[i].NumberOfTiggerPulls +
						'</td><td>' + gamesData[i].CylinderSize + '</td></tr>';
						}
						
	$('#gamelist tr').first().after(html);
	$('#gamelist').show();
	
}).fail(function() {
	$('#newGamePopup').show();
	$('#gamelist').hide();
  });
}


$( "#createNewGame" ).click(function() {
  var inputData = {
		"GameId": "none",
		"NumberOfTiggerPulls": 0,
		"CylinderSize": $('#cylinderSize').val()
  };
  
  $.ajax({
	type: "POST",
    url: "http://localhost:50712/v1/games",
	crossDomain: true,
    data: JSON.stringify(inputData),
    contentType: "application/json; charset=utf-8",
    dataType: "json",
	statusCode: {
		400: function(errMsg) {
			alert( errMsg.responseJSON.Message );
			$('#newGamePopup').hide();
			
		}
	},
    success: function(data){$('#newGamePopup').hide();populateGameList();},
    failure: function() {   }
  });
  
});

$( "#showNewGame" ).click(function() {
	$('#newGamePopup').show();
});
</script>
</body>
</html>